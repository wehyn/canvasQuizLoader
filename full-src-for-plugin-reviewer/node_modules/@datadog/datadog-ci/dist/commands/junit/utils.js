"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isFile = exports.getTestCommitRedirectURL = exports.getTestRunsUrl = exports.getBaseUrl = void 0;
const fs_1 = require("fs");
const app_1 = require("../../helpers/app");
const tags_1 = require("../../helpers/tags");
const getBaseUrl = () => {
    const site = process.env.DATADOG_SITE || process.env.DD_SITE || 'datadoghq.com';
    const subdomain = process.env.DD_SUBDOMAIN || '';
    return (0, app_1.getCommonAppBaseURL)(site, subdomain);
};
exports.getBaseUrl = getBaseUrl;
const getTestRunsUrl = (spanTags) => {
    if (!spanTags[tags_1.CI_PIPELINE_URL] && !spanTags[tags_1.CI_JOB_URL]) {
        return '';
    }
    let query = '';
    if (spanTags[tags_1.CI_JOB_URL]) {
        query += ` @ci.job.url:"${spanTags[tags_1.CI_JOB_URL]}"`;
    }
    else if (spanTags[tags_1.CI_PIPELINE_URL]) {
        query += ` @ci.pipeline.url:"${spanTags[tags_1.CI_PIPELINE_URL]}"`;
    }
    return `${(0, exports.getBaseUrl)()}ci/test-runs?query=${encodeURIComponent(query)}`;
};
exports.getTestRunsUrl = getTestRunsUrl;
const getTestCommitRedirectURL = (spanTags, service, env) => {
    if (!spanTags[tags_1.GIT_REPOSITORY_URL] || !spanTags[tags_1.GIT_BRANCH] || !spanTags[tags_1.GIT_SHA] || !service) {
        return '';
    }
    const encodedRepoUrl = encodeURIComponent(`${spanTags[tags_1.GIT_REPOSITORY_URL]}`);
    const encodedService = encodeURIComponent(service);
    const encodedBranch = encodeURIComponent(`${spanTags[tags_1.GIT_BRANCH]}`);
    const commitSha = `${spanTags[tags_1.GIT_SHA]}`;
    let url = `${(0, exports.getBaseUrl)()}ci/redirect/tests/${encodedRepoUrl}/-/${encodedService}/-/${encodedBranch}/-/${commitSha}`;
    if (env) {
        url += `?env=${encodeURIComponent(env)}`;
    }
    return url;
};
exports.getTestCommitRedirectURL = getTestCommitRedirectURL;
const isFile = (path) => {
    try {
        return (0, fs_1.lstatSync)(path).isFile();
    }
    catch (e) {
        return false;
    }
};
exports.isFile = isFile;
//# sourceMappingURL=utils.js.map